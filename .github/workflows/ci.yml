name: CI
on: [push]

jobs:
  # pre-commit-checks:
  #   name: Linux - pre-commit checks - Python 3.11
  #   timeout-minutes: 30
  #   runs-on: ubuntu-latest
  #   env:
  #     PRE_COMMIT_USE_MICROMAMBA: 1
  #   steps:
  #     - name: Checkout branch
  #       uses: actions/checkout@v4
  #     - name: Set up micromamba
  #       uses: mamba-org/setup-micromamba@f8b8a1e23a26f60a44c853292711bacfd3eac822
  #     - name: Add micromamba to GITHUB_PATH
  #       run: echo "${HOME}/micromamba-bin" >> "$GITHUB_PATH"
  #     - name: Install Python 3.11
  #       uses: actions/setup-python@v5
  #       with:
  #         python-version: "3.11"
  #     - name: Run pre-commit checks
  #       uses: pre-commit/action@v3.0.1

  unit-tests:
    name: Tests - ${{ matrix.os }} - ${{ matrix.environment }}
    runs-on: ${{ matrix.os }}
    env:
      CI: True
    strategy:
      fail-fast: true
      matrix:
        include:
          - { os: ubuntu-latest, environment: 'py39' }
          - { os: ubuntu-latest, environment: 'py310' }
          - { os: ubuntu-latest, environment: 'py311' }
          - { os: ubuntu-latest, environment: 'py312' }
          - { os: windows-latest, environment: 'py312' }
          - { os: macos-latest, environment: 'py312' }
    steps:
      - name: Checkout branch
        uses: actions/checkout@v4
      - name: Set up pixi
        uses: prefix-dev/setup-pixi@v0.8.0
        with:
          environments: ${{ matrix.environment }}
      - name: Install repository
        run: pixi run -e ${{ matrix.environment }} postinstall
      - name: Install repository (windows)
        if: matrix.os == 'windows-latest'
        shell: powershell
        run: pip install --no-use-pep517 --no-deps --disable-pip-version-check -e .
      - name: Run pytest
        run: pixi run -e ${{ matrix.environment }} test
